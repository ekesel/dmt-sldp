---
phase: 10
plan: 1
wave: 1
---

# Plan 10.1: Analytics Models & Migrations

## Objective
Implement storage for historical snapshots and sprint-level metrics within tenant schemas.

## Context
- .gsd/SPEC.md
- backend/data/models.py
- .gsd/phases/10/RESEARCH.md

## Tasks

<task type="auto">
  <name>Implement Analytics Models</name>
  <files>backend/data/models.py</files>
  <action>
    Add `DailyMetric` and `HistoricalSprintMetric` models to `backend/data/models.py`.
    - `DailyMetric` should track `total_work_items`, `compliant_work_items`, `compliance_rate`, `avg_cycle_time_hours`, and `prs_merged_count` per date.
    - `HistoricalSprintMetric` should link to `Sprint` and track `velocity`, `final_compliance_rate`, and `ai_efficiency_score`.
    - Ensure appropriate indexes on `date` and `sprint`.
  </action>
  <verify>docker-compose run --rm backend python3 manage.py check</verify>
  <done>Models defined without syntax errors and pass Django system checks.</done>
</task>

<task type="auto">
  <name>Generate and Apply Migrations</name>
  <files>backend/data/migrations/</files>
  <action>
    Run `makemigrations` and `migrate` (using `tenant_command` for all tenants).
  </action>
  <verify>docker-compose run --rm backend python3 manage.py tenant_command shell --schema=test_tenant -c "from data.models import DailyMetric; print(DailyMetric.objects.count())"</verify>
  <done>Migrations applied successfully across shared and tenant schemas.</done>
</task>

## Success Criteria
- [ ] `DailyMetric` and `HistoricalSprintMetric` tables exist in tenant schemas.
- [ ] Models are queryable in the Django shell.
